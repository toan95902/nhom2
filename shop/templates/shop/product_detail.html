{% extends "shop/base.html" %}
{% load humanize %}

{% block title %}Chi Ti·∫øt S·∫£n Ph·∫©m - {{ product.name }}{% endblock %}

{% block content %}
<div class="container my-5 animate__animated animate__fadeIn">
  <div class="row">
    <!-- C·ªôt h√¨nh ·∫£nh s·∫£n ph·∫©m -->
    <div class="col-md-6">
      <div class="card border-0 shadow-lg animate__animated animate__zoomIn">
        {% if product.image %}
          <img src="{{ product.image.url }}" class="card-img-top img-fluid" alt="{{ product.name }}" style="max-height: 500px; object-fit: cover;">
        {% else %}
          <img src="/media/products/default.jpg" class="card-img-top img-fluid" alt="S·∫£n ph·∫©m m·∫∑c ƒë·ªãnh" style="max-height: 500px; object-fit: cover;">
        {% endif %}
      </div>
    </div>
    <!-- C·ªôt th√¥ng tin s·∫£n ph·∫©m -->
    <div class="col-md-6">
      <h1 class="display-5 fw-bold animate__animated animate__fadeInDown">{{ product.name }}</h1>
      <p class="fs-4 text-danger fw-bold animate__animated animate__fadeInDown">üí∞ {{ product.price|intcomma }} VND</p>
      {% if product.discount > 0 %}
        <p class="fs-5 text-success fw-bold animate__animated animate__fadeInDown">Gi·∫£m {{ product.discount|intcomma }}%</p>
      {% endif %}
      <hr>
      <p class="lead animate__animated animate__fadeInUp">{{ product.description }}</p>
      <div class="d-flex flex-wrap gap-3 mt-4">
        <form method="POST" action="{% url 'shop:add_to_cart' product.id %}">
          {% csrf_token %}
          <button type="submit" class="btn btn-lg btn-success animate__animated animate__pulse animate__infinite">‚ûï Th√™m v√†o gi·ªè h√†ng</button>
        </form>
        <a href="{% url 'shop:product_list' %}" class="btn btn-lg btn-outline-primary animate__animated animate__fadeInUp">‚¨ÖÔ∏è Quay l·∫°i danh s√°ch s·∫£n ph·∫©m</a>
      </div>
    </div>
  </div>
  
  <!-- Ph·∫ßn ƒë√°nh gi√° s·∫£n ph·∫©m (n·∫øu c√≥) -->
  <section class="mt-5 animate__animated animate__fadeInUp">
    <h3 class="fw-bold">ƒê√°nh gi√° s·∫£n ph·∫©m</h3>
    <hr>
    {% if product.reviews.count %}
      <div class="list-group">
        {% for review in product.reviews.all %}
          <div class="list-group-item">
            <div class="d-flex justify-content-between align-items-center">
              <strong>{{ review.user.username }}</strong>
              <span class="text-warning">
                {% for i in "12345"|slice:":review.rating" %}
                  <i class="bi bi-star-fill"></i>
                {% endfor %}
                {% for i in "12345"|slice:"review.rating:" %}
                  <i class="bi bi-star"></i>
                {% endfor %}
              </span>
            </div>
            <p>{{ review.comment }}</p>
            <small class="text-muted">{{ review.created_at|date:"d/m/Y H:i" }}</small>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p>Ch∆∞a c√≥ ƒë√°nh gi√° n√†o cho s·∫£n ph·∫©m n√†y.</p>
    {% endif %}
    <!-- Form g·ª≠i ƒë√°nh gi√° m·ªõi (n·∫øu ng∆∞·ªùi d√πng ƒë√£ ƒëƒÉng nh·∫≠p) -->
    {% if user.is_authenticated %}
      <div class="mt-4">
        <h4>G·ª≠i ƒë√°nh gi√° c·ªßa b·∫°n</h4>
        <form method="POST" action="{% url 'shop:add_review' product.id %}">
          {% csrf_token %}
          <div class="mb-3">
            <label for="rating" class="form-label">ƒê√°nh gi√° (1-5):</label>
            <input type="number" name="rating" id="rating" class="form-control" min="1" max="5" required>
          </div>
          <div class="mb-3">
            <label for="comment" class="form-label">B√¨nh lu·∫≠n:</label>
            <textarea name="comment" id="comment" class="form-control" rows="3" required></textarea>
          </div>
          <button type="submit" class="btn btn-primary">G·ª≠i ƒë√°nh gi√°</button>
        </form>
      </div>
    {% else %}
      <p class="mt-4">Vui l√≤ng <a href="{% url 'shop:login' %}">ƒëƒÉng nh·∫≠p</a> ƒë·ªÉ g·ª≠i ƒë√°nh gi√°.</p>
    {% endif %}
  </section>
</div>
{% endblock %}
